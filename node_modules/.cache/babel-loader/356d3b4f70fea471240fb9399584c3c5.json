{"ast":null,"code":"import TradeMarketABI from '../contracts/MarketPlace.json';\nimport Web3 from \"web3/dist/web3.min.js\";\nconst web3 = new Web3('wss://ws-mumbai.matic.today');\nconst TradeServiceADDR = '0xd13643364b2D2d64e4621602ceC58069e6725564';\n\nconst tradeService = () => {\n  const contract_Instance = new web3.eth.Contract(TradeMarketABI, TradeServiceADDR);\n  return contract_Instance;\n};\n\nexport const getBalance = async SEND_ADDR => {\n  return new Promise(resolve => {\n    tradeService().methods.getMyDeposit().call({\n      from: SEND_ADDR\n    }).then(result => {\n      resolve(result);\n    });\n  });\n};\nexport const buyNFT = async (toknId, toknPrice, SEND_ADDR, PRIVATE_KEY) => {\n  console.log(toknPrice);\n  console.log(toknId);\n  const chainId = await web3.eth.getChainId();\n  const nonce = await web3.eth.getTransactionCount(SEND_ADDR, 'latest');\n  const method = tradeService().methods.buyTokn(toknId).send({\n    from: SEND_ADDR,\n    value: toknPrice\n  });\n  const gasPrice = await web3.eth.getGasPrice();\n  const estGas = await method.estimateGas({\n    from: SEND_ADDR\n  });\n  const code = await method.encodeABI();\n  const tx = {\n    nonce: nonce,\n    chainId: chainId,\n    from: SEND_ADDR,\n    to: TradeServiceADDR,\n    value: toknPrice,\n    data: code,\n    gasPrice: gasPrice,\n    gas: estGas\n  };\n  const result = await signTrx(tx, PRIVATE_KEY);\n  return result;\n};\n\nconst signTrx = (tx, PRIVATE_KEY) => {\n  return new Promise(resolve => {\n    web3.eth.accounts.signTransaction(tx, PRIVATE_KEY).then(signedTx => {\n      web3.eth.sendSignedTransaction(signedTx.rawTransaction, function (error, hash) {\n        if (!error) resolve(true);else resolve('Check again your Private_Key inputed');\n      });\n    }).catch(err => {\n      console.log(err.message);\n      resolve(err.message);\n    });\n  });\n};","map":{"version":3,"names":["TradeMarketABI","Web3","web3","TradeServiceADDR","tradeService","contract_Instance","eth","Contract","getBalance","SEND_ADDR","Promise","resolve","methods","getMyDeposit","call","from","then","result","buyNFT","toknId","toknPrice","PRIVATE_KEY","console","log","chainId","getChainId","nonce","getTransactionCount","method","buyTokn","send","value","gasPrice","getGasPrice","estGas","estimateGas","code","encodeABI","tx","to","data","gas","signTrx","accounts","signTransaction","signedTx","sendSignedTransaction","rawTransaction","error","hash","catch","err","message"],"sources":["/home/giparang/threadweb/fortune/client/src/utilityUnits/connTradeService.js"],"sourcesContent":["import TradeMarketABI from '../contracts/MarketPlace.json';\nimport Web3 from \"web3/dist/web3.min.js\";\nconst web3 = new Web3('wss://ws-mumbai.matic.today');\nconst TradeServiceADDR = '0xd13643364b2D2d64e4621602ceC58069e6725564';\n\nconst tradeService = () => {\n  const contract_Instance = new web3.eth.Contract(\n    TradeMarketABI, TradeServiceADDR\n  )\n  return contract_Instance;\n}\n\nexport const getBalance = async(SEND_ADDR) => {\n  return new Promise(resolve => {\n    tradeService().methods.getMyDeposit().call({from: SEND_ADDR}).then(\n      result => {\n        resolve(result);\n      }\n    )\n  })\n}\n\nexport const buyNFT = async(toknId, toknPrice, SEND_ADDR, PRIVATE_KEY) => {\n  console.log(toknPrice);\n  console.log(toknId);\n  const chainId = await web3.eth.getChainId();\n  const nonce = await web3.eth.getTransactionCount(SEND_ADDR, 'latest');\n  const method = tradeService().methods.buyTokn(toknId).send({from: SEND_ADDR, value: toknPrice});\n  const gasPrice = await web3.eth.getGasPrice();\n  const estGas = await method.estimateGas({from: SEND_ADDR});\n  const code = await method.encodeABI();\n  \n  const tx = {\n    nonce: nonce,\n    chainId: chainId,\n    from: SEND_ADDR,\n    to: TradeServiceADDR,\n    value: toknPrice,\n    data: code,\n    gasPrice: gasPrice,\n    gas: estGas\n  };\n  const result = await signTrx(tx, PRIVATE_KEY);\n  return result;\n}\nconst signTrx = (tx, PRIVATE_KEY) => {\n  return new Promise(resolve => {\n    web3.eth.accounts.signTransaction(tx, PRIVATE_KEY).then(signedTx => {\n      web3.eth.sendSignedTransaction(signedTx.rawTransaction, function(error, hash) {\n        if (!error)\n          resolve(true);\n        else\n          resolve('Check again your Private_Key inputed');\n      });\n    }).catch(err => {\n      console.log(err.message);\n      resolve(err.message);\n    })\n  })\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}