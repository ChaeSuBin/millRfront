{"ast":null,"code":"import _regeneratorRuntime from\"/home/giparang/threadweb/fortune/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/giparang/threadweb/fortune/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import TradeMarketABI from'../contracts/MarketPlace.json';import Web3 from\"web3/dist/web3.min.js\";var web3=new Web3('https://rpc-mumbai.matic.today');var TradeServiceADDR='0x1434F691eCefeA03ce6532a4cA99FD7E08764e2d';var tradeService=function tradeService(){var contract_Instance=new web3.eth.Contract(TradeMarketABI,TradeServiceADDR);return contract_Instance;};export var getTradeBalance=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(SEND_ADDR){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",new Promise(function(resolve){tradeService().methods.getMyDeposit().call({from:SEND_ADDR}).then(function(result){resolve(result);});}));case 1:case\"end\":return _context.stop();}}},_callee);}));return function getTradeBalance(_x){return _ref.apply(this,arguments);};}();export var eventTradeTokn=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(ADDR){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",new Promise(function(resolve){tradeService().events.tradingEvt({filter:{buyer:ADDR},fromBlock:'latest'},function(err,evt){console.log('event call: ',evt);resolve(evt.returnValues);});}));case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function eventTradeTokn(_x2){return _ref2.apply(this,arguments);};}();export var buyNFT=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(SEND_ADDR,PRIVATE_KEY,toknId,toknPrice){var chainId,nonce,method,gasPrice,code;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return web3.eth.getChainId();case 2:chainId=_context3.sent;_context3.next=5;return web3.eth.getTransactionCount(SEND_ADDR,'latest');case 5:nonce=_context3.sent;method=tradeService().methods.buyTokn(toknId);_context3.next=9;return web3.eth.getGasPrice();case 9:gasPrice=_context3.sent;_context3.next=12;return method.encodeABI();case 12:code=_context3.sent;return _context3.abrupt(\"return\",new Promise(function(resolve){method.estimateGas({from:SEND_ADDR,value:toknPrice}).then(function(estGas){var tx={nonce:nonce,chainId:chainId,from:SEND_ADDR,to:TradeServiceADDR,value:toknPrice,//web3.utils.toHex(web3.utils.toWei(toknPrice, 'ether')),\ndata:code,gasPrice:gasPrice,gas:estGas};signTrx(tx,PRIVATE_KEY).then(function(result){console.log(result);resolve(result);});}).catch(function(err){console.log(err);resolve(err);});}));case 14:case\"end\":return _context3.stop();}}},_callee3);}));return function buyNFT(_x3,_x4,_x5,_x6){return _ref3.apply(this,arguments);};}();export var withdrawSaleToknPrice=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(SEND_ADDR,PRIVATE_KEY,amount){var chainId,nonce,method,gasPrice,code;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return web3.eth.getChainId();case 2:chainId=_context4.sent;_context4.next=5;return web3.eth.getTransactionCount(SEND_ADDR,'latest');case 5:nonce=_context4.sent;_context4.next=8;return tradeService().methods.withDrawal(amount);case 8:method=_context4.sent;_context4.next=11;return web3.eth.getGasPrice();case 11:gasPrice=_context4.sent;_context4.next=14;return method.encodeABI();case 14:code=_context4.sent;return _context4.abrupt(\"return\",new Promise(function(resolve){method.estimateGas({from:SEND_ADDR}).then(function(estGas){var tx={nonce:nonce,chainId:chainId,from:SEND_ADDR,to:TradeServiceADDR,value:'0',data:code,gasPrice:gasPrice,gas:estGas};signTrx(tx,PRIVATE_KEY).then(function(result){console.log(result);resolve(result);});}).catch(function(err){console.log(err);resolve(err);});}));case 16:case\"end\":return _context4.stop();}}},_callee4);}));return function withdrawSaleToknPrice(_x7,_x8,_x9){return _ref4.apply(this,arguments);};}();var signTrx=function signTrx(tx,PRIVATE_KEY){return new Promise(function(resolve){web3.eth.accounts.signTransaction(tx,PRIVATE_KEY).then(function(signedTx){web3.eth.sendSignedTransaction(signedTx.rawTransaction,function(error,hash){if(!error)resolve(true);else resolve('Check again your Private_Key inputed');});}).catch(function(err){console.log(err.message);resolve(err.message);});});};","map":{"version":3,"names":["TradeMarketABI","Web3","web3","TradeServiceADDR","tradeService","contract_Instance","eth","Contract","getTradeBalance","SEND_ADDR","Promise","resolve","methods","getMyDeposit","call","from","then","result","eventTradeTokn","ADDR","events","tradingEvt","filter","buyer","fromBlock","err","evt","console","log","returnValues","buyNFT","PRIVATE_KEY","toknId","toknPrice","getChainId","chainId","getTransactionCount","nonce","method","buyTokn","getGasPrice","gasPrice","encodeABI","code","estimateGas","value","estGas","tx","to","data","gas","signTrx","catch","withdrawSaleToknPrice","amount","withDrawal","accounts","signTransaction","signedTx","sendSignedTransaction","rawTransaction","error","hash","message"],"sources":["/home/giparang/threadweb/fortune/client/src/utilityUnits/connTradeService.js"],"sourcesContent":["import TradeMarketABI from '../contracts/MarketPlace.json';\nimport Web3 from \"web3/dist/web3.min.js\";\nconst web3 = new Web3('https://rpc-mumbai.matic.today');\nconst TradeServiceADDR = '0x1434F691eCefeA03ce6532a4cA99FD7E08764e2d';\n\nconst tradeService = () => {\n  const contract_Instance = new web3.eth.Contract(\n    TradeMarketABI, TradeServiceADDR\n  )\n  return contract_Instance;\n}\n\nexport const getTradeBalance = async(SEND_ADDR) => {\n  return new Promise(resolve => {\n    tradeService().methods.getMyDeposit().call({from: SEND_ADDR}).then(\n      result => {\n        resolve(result);\n      }\n    )\n  })\n}\nexport const eventTradeTokn = async(ADDR) => {\n  return new Promise(resolve => {\n    tradeService().events.tradingEvt(\n      {filter: {buyer: ADDR},\n      fromBlock: 'latest'},\n      (err, evt) => {\n        console.log('event call: ', evt);\n        resolve(evt.returnValues);            \n    })\n  })\n}\n\nexport const buyNFT = async(SEND_ADDR, PRIVATE_KEY, toknId, toknPrice) => {\n  const chainId = await web3.eth.getChainId();\n  const nonce = await web3.eth.getTransactionCount(SEND_ADDR, 'latest');\n  const method = tradeService().methods.buyTokn(toknId);\n  const gasPrice = await web3.eth.getGasPrice();\n  const code = await method.encodeABI();\n  return new Promise(resolve => {\n    method.estimateGas({from: SEND_ADDR, value: toknPrice}).then(estGas => {\n      const tx = {\n        nonce: nonce,\n        chainId: chainId,\n        from: SEND_ADDR,\n        to: TradeServiceADDR,\n        value: toknPrice, //web3.utils.toHex(web3.utils.toWei(toknPrice, 'ether')),\n        data: code,\n        gasPrice: gasPrice,\n        gas: estGas\n      };\n      signTrx(tx, PRIVATE_KEY).then(result => {\n        console.log(result);\n        resolve(result);\n      })\n    }).catch(err => {\n      console.log(err);\n      resolve(err);\n    })\n  })\n}\n\nexport const withdrawSaleToknPrice = async(SEND_ADDR, PRIVATE_KEY, amount) => {\n  const chainId = await web3.eth.getChainId();\n  const nonce = await web3.eth.getTransactionCount(SEND_ADDR, 'latest');\n  \n  const method = await tradeService().methods.withDrawal(amount);\n  const gasPrice = await web3.eth.getGasPrice();\n  const code = await method.encodeABI();\n  return new Promise(resolve => {\n    method.estimateGas({from: SEND_ADDR}).then(estGas => {\n      const tx = {\n        nonce: nonce,\n        chainId: chainId,\n        from: SEND_ADDR,\n        to: TradeServiceADDR,\n        value: '0',\n        data: code,\n        gasPrice: gasPrice,\n        gas: estGas\n      }\n      signTrx(tx, PRIVATE_KEY).then(result => {\n        console.log(result);\n        resolve(result);\n      })\n    }).catch(err => {\n      console.log(err);\n      resolve(err);\n    })\n  })\n}\nconst signTrx = (tx, PRIVATE_KEY) => {\n  return new Promise(resolve => {\n    web3.eth.accounts.signTransaction(tx, PRIVATE_KEY).then(signedTx => {\n      web3.eth.sendSignedTransaction(signedTx.rawTransaction, function(error, hash) {\n        if (!error)\n          resolve(true);\n        else\n          resolve('Check again your Private_Key inputed');\n      });\n    }).catch(err => {\n      console.log(err.message);\n      resolve(err.message);\n    })\n  })\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}