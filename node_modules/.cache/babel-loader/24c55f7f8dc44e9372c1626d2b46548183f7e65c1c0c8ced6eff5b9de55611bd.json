{"ast":null,"code":"import _regeneratorRuntime from\"/home/giparang/threadweb/fortune/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/giparang/threadweb/fortune/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/giparang/threadweb/fortune/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from\"react\";import{onFileInputChange}from\"../../utilityUnits/fileToBuffer\";import{fileToHash,setFinalHash}from'../../utilityUnits/fileToHash';import{FilesList}from\"../../components/dispFileList\";import{UploadFiles}from\"./uploadFiles\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var SetFileHash=function SetFileHash(_ref){var pWire=_ref.pWire;var te=-1;var hashArr=[];var _useState=useState([]),_useState2=_slicedToArray(_useState,2),fileBuffer=_useState2[0],setFileBuffer=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),fileInfo=_useState4[0],setFileInfo=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),fileHashs=_useState6[0],setFileHashs=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),endHash=_useState8[0],setEndHash=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),passA=_useState10[0],setCheckA=_useState10[1];useEffect(function(){pWire(endHash);},[endHash]);var extractHash=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setCheckA(false);sortFileSize().then(function(result){if(result){getFileHashArr();}});case 2:case\"end\":return _context.stop();}}},_callee);}));return function extractHash(){return _ref2.apply(this,arguments);};}();var getFileHashArr=function getFileHashArr(){hashArr=fileToHash(fileBuffer,setFileHashs);var endHash=getFinalHash(hashArr);UploadFiles(fileBuffer,fileInfo,endHash);setEndHash(endHash);};var sortFileSize=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var asc,ascIndex;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:asc=function asc(a,b){return a.length<b.length?-1:1;//オブジェクトの昇順ソート\n};ascIndex=function ascIndex(a,b){return a.size<b.size?-1:1;};if(!(fileBuffer.length!==0)){_context2.next=8;break;}fileBuffer.sort(asc);fileInfo.sort(ascIndex);return _context2.abrupt(\"return\",true);case 8:return _context2.abrupt(\"return\",false);case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function sortFileSize(){return _ref3.apply(this,arguments);};}();var getFinalHash=function getFinalHash(_hashArr){var fileNum=0;var hashsStr='';//let fileTypeArr = [];\ndo{hashsStr+=_hashArr[fileNum];//fileTypeArr.push((fileInfo[fileNum].type).split('/').pop());\n++fileNum;}while(_hashArr.length>fileNum);return setFinalHash(hashsStr);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uC5C5\\uB85C\\uB4DC\\uD560 \\uD30C\\uC77C \\uC120\\uD0DD\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\uBB38\\uC11C, \\uC774\\uBBF8\\uC9C0, \\uC624\\uB514\\uC624, \\uB3D9\\uC601\\uC0C1 \\uD30C\\uC77C \\uAC00\\uB2A5\"}),/*#__PURE__*/_jsx(\"label\",{className:\"inputfile\",children:/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:function onChange(evt){return onFileInputChange(evt,setFileBuffer,setFileInfo,setCheckA);},multiple:true})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),fileInfo.map(function(uploadItems){return/*#__PURE__*/_jsx(FilesList,{row:++te,title:uploadItems.name,type:uploadItems.type,size:uploadItems.size,hash:fileHashs[te]},uploadItems.name);}),passA?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:extractHash,children:\"\\uD30C\\uC77C \\uC5C5\\uB85C\\uB4DC\"}),\"-\\uBC84\\uD2BC\\uC744 \\uB204\\uB978 \\uD6C4 \\uC7A0\\uC2DC \\uAE30\\uB2E4\\uB824\\uC8FC\\uC138\\uC694.\"]}):/*#__PURE__*/_jsx(_Fragment,{})]});};","map":{"version":3,"names":["React","useState","useEffect","onFileInputChange","fileToHash","setFinalHash","FilesList","UploadFiles","SetFileHash","pWire","te","hashArr","fileBuffer","setFileBuffer","fileInfo","setFileInfo","fileHashs","setFileHashs","endHash","setEndHash","passA","setCheckA","extractHash","sortFileSize","then","result","getFileHashArr","getFinalHash","asc","a","b","length","ascIndex","size","sort","_hashArr","fileNum","hashsStr","evt","map","uploadItems","name","type"],"sources":["/home/giparang/threadweb/fortune/client/src/components/uploadIDX/setFileHash.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { onFileInputChange } from \"../../utilityUnits/fileToBuffer\";\nimport { fileToHash, setFinalHash } from '../../utilityUnits/fileToHash'\nimport { FilesList } from \"../../components/dispFileList\";\nimport { UploadFiles } from \"./uploadFiles\";\n\nexport const SetFileHash = ({pWire}) => {\n\n  let te = -1;\n  let hashArr = [];\n  const [fileBuffer, setFileBuffer] = useState([]);\n  const [fileInfo, setFileInfo] = useState([]);\n  const [fileHashs, setFileHashs] = useState([]);\n  const [endHash, setEndHash] = useState();\n  const [passA, setCheckA] = useState(false);\n\n  useEffect(() => {\n    pWire(endHash);\n  },[endHash])\n  \n  const extractHash = async() => {\n    setCheckA(false);\n    sortFileSize().then(result => {\n      if(result){\n        getFileHashArr();\n      }\n    })\n  }\n  const getFileHashArr = () => {\n    hashArr = fileToHash(fileBuffer, setFileHashs);\n    const endHash = getFinalHash(hashArr);\n    UploadFiles(fileBuffer, fileInfo, endHash);\n    setEndHash(endHash);\n  }\n\n  const sortFileSize = async() => {\n    let asc = function (a, b) {\n      return (a.length < b.length) ? -1 : 1;  //オブジェクトの昇順ソート\n    }\n    let ascIndex = function(a, b) {\n      return (a.size < b.size) ? -1 : 1;\n    }\n    if(fileBuffer.length !== 0){\n      fileBuffer.sort(asc);\n      fileInfo.sort(ascIndex);\n      return true;\n    }\n    else{\n      return false;\n    }  \n  }\n  \n  const getFinalHash = (_hashArr) => {\n    let fileNum = 0;\n    let hashsStr = '';\n    //let fileTypeArr = [];\n    do {\n      hashsStr += _hashArr[fileNum];\n      //fileTypeArr.push((fileInfo[fileNum].type).split('/').pop());\n      ++fileNum;\n    } while (_hashArr.length > fileNum);\n    return setFinalHash(hashsStr);\n  }\n\n  return(\n    <div>\n      <h3>업로드할 파일 선택</h3>\n      <p>문서, 이미지, 오디오, 동영상 파일 가능</p>\n      <label className=\"inputfile\"><input type='file' \n        onChange={(evt)=>\n          onFileInputChange(evt, setFileBuffer, setFileInfo, setCheckA)} \n        multiple/></label><br/>\n      <br/>\n      {fileInfo.map(uploadItems => (\n        <FilesList\n          key={uploadItems.name}\n          row={++te}\n          title = {uploadItems.name}\n          type = {uploadItems.type}\n          size = {uploadItems.size}\n          hash = {fileHashs[te]}\n        />\n      ))}\n      {passA ? \n      <>\n        <button onClick={extractHash}>파일 업로드</button>-버튼을 누른 후 잠시 기다려주세요.\n      </>:<>\n      \n      </>}\n    </div>\n  )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}