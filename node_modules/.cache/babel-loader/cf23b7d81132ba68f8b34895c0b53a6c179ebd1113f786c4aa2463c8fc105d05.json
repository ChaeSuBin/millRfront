{"ast":null,"code":"import _regeneratorRuntime from\"/home/giparang/threadweb/fortune/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/giparang/threadweb/fortune/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/giparang/threadweb/fortune/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import{useEffect,useState,useRef}from'react';import{useNavigate}from'react-router-dom';import{postUploadItemIdx,getUserId,putLogin}from'../../api';import{eventCreateItem,setNFTidx}from'../../utilityUnits/connMintService';import{SHA256}from'../../utilityUnits/SHA256';import{WaitModal}from'../waitModal';import{Help}from'../helpCpnt';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var SetItemCpnt=function SetItemCpnt(_ref){var title=_ref.title,desc=_ref.desc,toknUri=_ref.toknUri,rightInfo=_ref.rightInfo;var SEND_ADDR=sessionStorage.getItem('chainid');var navigate=useNavigate();var _useState=useState(),_useState2=_slicedToArray(_useState,2),NumOfTokn=_useState2[0],setNumOfTokn=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),price=_useState4[0],setValue=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),PRIVATE_KEY=_useState6[0],setPrivKey=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),modalFlag=_useState8[0],setFlag=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),Royalty=_useState10[0],setLowest=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),active=_useState12[0],setActive=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),helpFlag=_useState14[0],setHelp=_useState14[1];var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),helpMode=_useState16[0],setHmode=_useState16[1];var exclusiveParsing=function exclusiveParsing(){var result=rightInfo.split('/');//console.log(result[1]);\nif(result[1]==='Exclusive'){setActive(true);setNumOfTokn(1);}else setActive(false);};var setItem=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var royality,value,tokenUri,record;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:royality=parseInt(Royalty*100000)+'0000000000000';value=parseInt(price*100000)+'0000000000000';tokenUri=rightInfo+toknUri;if(!(title!==''&&desc!==''&&price!==undefined&&NumOfTokn!==undefined)){_context.next=15;break;}record={playerId:sessionStorage.getItem('userid'),playerPass:SHA256(PRIVATE_KEY)};_context.next=7;return putLogin(record);case 7:if(!_context.sent){_context.next=11;break;}setNFTidx(SEND_ADDR,PRIVATE_KEY,tokenUri,value,royality,NumOfTokn).then(function(result){if(result===true){console.log(10000);uploadItemIdx();}else{alert('폴리곤 네트워크에 정보를 쓰기위한 수수료(gas)가 부족합니다\\n계좌의 폴리곤 코인을 충전 후 다시 시도하여 주십시오.');setFlag(false);}});_context.next=13;break;case 11:alert('Private Key 를 다시 확인 후 시도하십시오');setFlag(false);case 13:_context.next=17;break;case 15:setFlag(false);alert('아이템 정보, 발행 정보를 정확히 입력한 후 다시 시도하십시오');case 17:case\"end\":return _context.stop();}}},_callee);}));return function setItem(){return _ref2.apply(this,arguments);};}();var uploadItemIdx=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_itemId){var userId,record;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getUserId(SEND_ADDR);case 2:userId=_context2.sent;record={//itemId: parseInt(_itemId),\ntitle:title,desc:desc,hash:toknUri,userId:userId,fromAddr:SEND_ADDR};postUploadItemIdx(record).then(function(response){console.log('checka');if(response){setFlag(false);alert('🎉Successfully Created');navigate(\"/\");}});case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function uploadItemIdx(_x){return _ref3.apply(this,arguments);};}();// const itemCreateEvtListener = async() => {\n//   eventCreateItem(SEND_ADDR).then(listen => {\n//     if(listen){\n//       uploadItemIdx(listen.itemId);\n//     }\n//   }).catch(err => {\n//     console.log(err);\n//   })\n// }\nvar openHelp=function openHelp(evt,_displayMode){setHelp(true);setHmode(_displayMode);document.addEventListener('click',closeModal);evt.stopPropagation();};var closeModal=function closeModal(){setHelp(false);document.removeEventListener('click',closeModal);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uC544\\uC774\\uD15C \\uD310\\uB9E4\\uC815\\uBCF4 \\uC785\\uB825\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uBC1C\\uD589\\uC218\\uB7C9: \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"quantity of token\",onChange:function onChange(evt){return setNumOfTokn(evt.target.value);},disabled:active}),/*#__PURE__*/_jsx(\"a\",{onClick:function onClick(evt){return openHelp(evt,4);},style:{cursor:\"help\"},children:\"\\u2753\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uBC1C\\uD589\\uAC00\\uACA9: \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",placeholder:\"price of token\",onChange:function onChange(evt){return setValue(evt.target.value);}}),/*#__PURE__*/_jsx(\"a\",{onClick:function onClick(evt){return openHelp(evt,5);},style:{cursor:\"help\"},children:\"\\u2753\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uB85C\\uC5F4\\uD2F0: \",/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"MATIC\",onChange:function onChange(evt){return setLowest(evt.target.value);},defaultValue:\"0\"}),/*#__PURE__*/_jsx(\"a\",{onClick:function onClick(evt){return openHelp(evt,1);},style:{cursor:\"help\"},children:\"\\u2753\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"private Key: \",/*#__PURE__*/_jsx(\"input\",{placeholder:\"input your private key to mint nft\",onChange:function onChange(evt){return setPrivKey(evt.target.value);},size:\"45\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){setFlag(true);setItem();},children:\"\\uD310\\uB9E4\\uC2DC\\uC791\"}),/*#__PURE__*/_jsx(WaitModal,{showFlag:modalFlag}),/*#__PURE__*/_jsx(Help,{showFlag:helpFlag,display:helpMode})]});};// const stopTimer = () => {\n//   clearInterval(intervalId);\n//   intervalId=null;\n//   count = 0;\n// }","map":{"version":3,"names":["React","useEffect","useState","useRef","useNavigate","postUploadItemIdx","getUserId","putLogin","eventCreateItem","setNFTidx","SHA256","WaitModal","Help","SetItemCpnt","title","desc","toknUri","rightInfo","SEND_ADDR","sessionStorage","getItem","navigate","NumOfTokn","setNumOfTokn","price","setValue","PRIVATE_KEY","setPrivKey","modalFlag","setFlag","Royalty","setLowest","active","setActive","helpFlag","setHelp","helpMode","setHmode","exclusiveParsing","result","split","setItem","royality","parseInt","value","tokenUri","undefined","record","playerId","playerPass","then","console","log","uploadItemIdx","alert","_itemId","userId","hash","fromAddr","response","openHelp","evt","_displayMode","document","addEventListener","closeModal","stopPropagation","removeEventListener","target","cursor"],"sources":["/home/giparang/threadweb/fortune/client/src/components/uploadIDX/setItem.js"],"sourcesContent":["import React from 'react';\nimport { useEffect, useState, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { postUploadItemIdx, getUserId, putLogin } from '../../api';\nimport { eventCreateItem, setNFTidx } from '../../utilityUnits/connMintService';\nimport { SHA256 } from '../../utilityUnits/SHA256';\nimport { WaitModal } from '../waitModal';\nimport { Help } from '../helpCpnt';\n\nexport const SetItemCpnt = ({title, desc, toknUri, rightInfo}) => {\n  const SEND_ADDR = sessionStorage.getItem('chainid');\n  const navigate = useNavigate();\n  const [NumOfTokn, setNumOfTokn] = useState();\n  const [price, setValue] = useState();\n  const [PRIVATE_KEY, setPrivKey] = useState(null);\n  const [modalFlag, setFlag] = useState(false);\n  const [Royalty, setLowest] = useState(0);\n  const [active, setActive] = useState(false);\n  const [helpFlag, setHelp] = useState(false);\n  const [helpMode, setHmode] = useState();\n\n  const exclusiveParsing = () => {\n    let result = rightInfo.split('/');\n    //console.log(result[1]);\n    if(result[1] === 'Exclusive'){\n      setActive(true);\n      setNumOfTokn(1);\n    }\n    else\n      setActive(false);\n  }\n\n  const setItem = async() => {\n    const royality = parseInt(Royalty*100000)+'0000000000000';\n    const value = parseInt(price*100000)+'0000000000000';\n    const tokenUri = rightInfo+toknUri;\n    \n    if(title !== '' && desc !== '' && price !== undefined && NumOfTokn !== undefined){\n      const record = {\n        playerId: sessionStorage.getItem('userid'),\n        playerPass: SHA256(PRIVATE_KEY)\n      }\n      if(await putLogin(record)){\n        setNFTidx(SEND_ADDR, PRIVATE_KEY, tokenUri, value, royality, NumOfTokn).then(result => {\n          if(result === true){\n            console.log(10000);\n            uploadItemIdx();\n          }\n          else{\n            alert('폴리곤 네트워크에 정보를 쓰기위한 수수료(gas)가 부족합니다\\n계좌의 폴리곤 코인을 충전 후 다시 시도하여 주십시오.');\n            setFlag(false);\n          }\n        })\n      }\n      else{\n        alert('Private Key 를 다시 확인 후 시도하십시오');\n        setFlag(false);}\n    }\n    else{\n      setFlag(false);\n      alert('아이템 정보, 발행 정보를 정확히 입력한 후 다시 시도하십시오');\n    }\n  }\n  const uploadItemIdx = async(_itemId) => {\n    const userId = await getUserId(SEND_ADDR);\n    const record = {\n      //itemId: parseInt(_itemId),\n      title: title,\n      desc: desc,\n      hash: toknUri,\n      userId: userId,\n      fromAddr: SEND_ADDR\n    }\n    postUploadItemIdx(record).then(response => {\n      console.log('checka')\n      if(response){\n        setFlag(false);\n        alert('🎉Successfully Created');\n        navigate(\"/\");\n      }\n    })\n  }\n  // const itemCreateEvtListener = async() => {\n  //   eventCreateItem(SEND_ADDR).then(listen => {\n  //     if(listen){\n  //       uploadItemIdx(listen.itemId);\n  //     }\n  //   }).catch(err => {\n  //     console.log(err);\n  //   })\n  // }\n  const openHelp = (evt, _displayMode) => {\n    setHelp(true);\n    setHmode(_displayMode);\n    document.addEventListener('click',closeModal);\n    evt.stopPropagation();\n  }\n  const closeModal = () => {\n    setHelp(false);\n    document.removeEventListener('click',closeModal);\n  }\n  return(\n    <>\n    {/* <button onClick={putDBtoknIDX}>temp</button> */}\n    <h3>아이템 판매정보 입력</h3>\n    <p>발행수량: <input type=\"number\" placeholder='quantity of token' onChange={(evt)=>setNumOfTokn(evt.target.value)} disabled={active}/><a onClick={(evt) => openHelp(evt, 4)} style={{cursor: \"help\"}}>❓</a></p>\n    <p>발행가격: <input type=\"number\" step=\"0.01\" placeholder='price of token' onChange={(evt)=>setValue(evt.target.value)} /><a onClick={(evt) => openHelp(evt, 5)} style={{cursor: \"help\"}}>❓</a></p>\n    <p>로열티: <input type=\"number\" placeholder='MATIC' onChange={(evt)=>setLowest(evt.target.value)} defaultValue='0'/><a onClick={(evt) => openHelp(evt, 1)} style={{cursor: \"help\"}}>❓</a></p>\n    <p>private Key: <input placeholder='input your private key to mint nft' onChange={(evt)=>setPrivKey(evt.target.value)} size='45'/></p>\n    <button onClick={() => {setFlag(true); setItem();}}>판매시작</button>\n    <WaitModal showFlag={modalFlag} />\n    <Help\n      showFlag={helpFlag}\n      display={helpMode}\n    />\n    </>\n  )\n}\n// const stopTimer = () => {\n//   clearInterval(intervalId);\n//   intervalId=null;\n//   count = 0;\n// }"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}