{"ast":null,"code":"import _regeneratorRuntime from\"/home/giparang/threadweb/fortune/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/giparang/threadweb/fortune/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{getTokenUri,mintingToken}from'../../utilityUnits/connMintService';import{getToknId,getUserId,postMintTokn,putLogin}from'../../api';import{SHA256}from'../../utilityUnits/SHA256';export var buyToknMint=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_price,_itemId,set_w_Flag,FROM_ADDR,PRIVATE_KEY){var record,value;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:record={playerId:sessionStorage.getItem('userid'),playerPass:SHA256(PRIVATE_KEY)};_context.next=3;return putLogin(record);case 3:if(!_context.sent){_context.next=8;break;}value=parseInt(_price*100000)+'0000000000000';mintingToken(FROM_ADDR,PRIVATE_KEY,_itemId,value).then(function(result){if(result===true)serveToknIdx(FROM_ADDR,_itemId);else{alert('거래에 필요한 폴리곤 코인이 부족합니다 \\n 코인을 충전한 후 다시 시도하여 주십시오');set_w_Flag(false);}});_context.next=10;break;case 8:alert('Private Key 를 확인 후 다시 시도하십시오');set_w_Flag(false);case 10:case\"end\":return _context.stop();}}},_callee);}));return function buyToknMint(_x,_x2,_x3,_x4,_x5){return _ref.apply(this,arguments);};}();export var serveToknIdx=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(FROM_ADDR,_itemId){var userId,toknId,fileHash,record;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getUserId(FROM_ADDR);case 2:userId=_context2.sent;_context2.next=5;return getToknId(FROM_ADDR);case 5:toknId=_context2.sent;_context2.next=8;return getFileHash(toknId);case 8:fileHash=_context2.sent;record={hash:fileHash,toknId:toknId,itemId:_itemId,userId:userId};// if(_remain == 1){\n//   console.log(_remain);\n//   putItemClose({itemID: idxId});\n// }\npostMintTokn(record).then(function(resultIdx){if(resultIdx){//set_w_Flag(false); setFlag(false);\nif(!alert('🎉Successfully purchased'))window.location.reload();}});case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function serveToknIdx(_x6,_x7){return _ref2.apply(this,arguments);};}();var getFileHash=function getFileHash(_toknId){return new Promise(function(resolve){var looper=setInterval(function(){getTokenUri(_toknId).then(function(toknURI){if(toknURI){var splitedUri=toknURI.split('/');clearInterval(looper);resolve(splitedUri[4]);}});},1000);});};","map":{"version":3,"names":["getTokenUri","mintingToken","getToknId","getUserId","postMintTokn","putLogin","SHA256","buyToknMint","_price","_itemId","set_w_Flag","FROM_ADDR","PRIVATE_KEY","record","playerId","sessionStorage","getItem","playerPass","value","parseInt","then","result","serveToknIdx","alert","userId","toknId","getFileHash","fileHash","hash","itemId","resultIdx","window","location","reload","_toknId","Promise","resolve","looper","setInterval","toknURI","splitedUri","split","clearInterval"],"sources":["/home/giparang/threadweb/fortune/client/src/components/detailPages/toknMint.js"],"sourcesContent":["import { getTokenUri, mintingToken } from '../../utilityUnits/connMintService';\nimport { getToknId, getUserId, postMintTokn, putLogin } from '../../api';\nimport { SHA256 } from '../../utilityUnits/SHA256';\n\nexport const buyToknMint = async(_price, _itemId, set_w_Flag, FROM_ADDR, PRIVATE_KEY) => {\n  const record = {\n    playerId: sessionStorage.getItem('userid'),\n    playerPass: SHA256(PRIVATE_KEY)\n  }\n  if(await putLogin(record)){\n    const value = parseInt(_price*100000) + '0000000000000';\n    mintingToken(FROM_ADDR, PRIVATE_KEY, _itemId, value).then(result => {\n      if(result === true)\n        serveToknIdx(FROM_ADDR, _itemId);\n      else{\n        alert('거래에 필요한 폴리곤 코인이 부족합니다 \\n 코인을 충전한 후 다시 시도하여 주십시오');\n        set_w_Flag(false)\n      }\n    })\n  }\n  else{\n    alert('Private Key 를 확인 후 다시 시도하십시오');\n    set_w_Flag(false);\n  }\n}\n\nexport const serveToknIdx = async(FROM_ADDR, _itemId) => {\n  const userId = await getUserId(FROM_ADDR);\n  const toknId = await getToknId(FROM_ADDR);\n  const fileHash = await getFileHash(toknId);\n  const record = {\n    hash: fileHash,\n    toknId: toknId,\n    itemId: _itemId,\n    userId: userId\n  }\n  // if(_remain == 1){\n  //   console.log(_remain);\n  //   putItemClose({itemID: idxId});\n  // }\n  postMintTokn(record).then(resultIdx => {\n    if(resultIdx){\n      //set_w_Flag(false); setFlag(false);\n      if(!alert('🎉Successfully purchased'))\n        window.location.reload();\n    }\n  })\n}\n\nconst getFileHash = (_toknId) => {\n  return new Promise(resolve => {\n    const looper = setInterval(() => {\n      getTokenUri(_toknId).then(toknURI => {\n        if(toknURI){\n          const splitedUri = toknURI.split('/');\n          clearInterval(looper);\n          resolve(splitedUri[4]);\n        }\n      })\n    }, 1000);\n  })\n}"],"mappings":"0QAAA,OAASA,WAAW,CAAEC,YAAY,KAAQ,oCAAoC,CAC9E,OAASC,SAAS,CAAEC,SAAS,CAAEC,YAAY,CAAEC,QAAQ,KAAQ,WAAW,CACxE,OAASC,MAAM,KAAQ,2BAA2B,CAElD,MAAO,IAAMC,YAAW,4FAAG,iBAAMC,MAAM,CAAEC,OAAO,CAAEC,UAAU,CAAEC,SAAS,CAAEC,WAAW,qIAC5EC,MAAM,CAAG,CACbC,QAAQ,CAAEC,cAAc,CAACC,OAAO,CAAC,QAAQ,CAAC,CAC1CC,UAAU,CAAEX,MAAM,CAACM,WAAW,CAChC,CAAC,uBACQP,SAAQ,CAACQ,MAAM,CAAC,kDACjBK,KAAK,CAAGC,QAAQ,CAACX,MAAM,CAAC,MAAM,CAAC,CAAG,eAAe,CACvDP,YAAY,CAACU,SAAS,CAAEC,WAAW,CAAEH,OAAO,CAAES,KAAK,CAAC,CAACE,IAAI,CAAC,SAAAC,MAAM,CAAI,CAClE,GAAGA,MAAM,GAAK,IAAI,CAChBC,YAAY,CAACX,SAAS,CAAEF,OAAO,CAAC,CAAC,IAC/B,CACFc,KAAK,CAAC,iDAAiD,CAAC,CACxDb,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAAC,+BAGFa,KAAK,CAAC,8BAA8B,CAAC,CACrCb,UAAU,CAAC,KAAK,CAAC,CAAC,uDAErB,kBApBYH,YAAW,4DAoBvB,CAED,MAAO,IAAMe,aAAY,6FAAG,kBAAMX,SAAS,CAAEF,OAAO,iLAC7BN,UAAS,CAACQ,SAAS,CAAC,QAAnCa,MAAM,uCACStB,UAAS,CAACS,SAAS,CAAC,QAAnCc,MAAM,uCACWC,YAAW,CAACD,MAAM,CAAC,QAApCE,QAAQ,gBACRd,MAAM,CAAG,CACbe,IAAI,CAAED,QAAQ,CACdF,MAAM,CAAEA,MAAM,CACdI,MAAM,CAAEpB,OAAO,CACfe,MAAM,CAAEA,MACV,CAAC,CACD;AACA;AACA;AACA;AACApB,YAAY,CAACS,MAAM,CAAC,CAACO,IAAI,CAAC,SAAAU,SAAS,CAAI,CACrC,GAAGA,SAAS,CAAC,CACX;AACA,GAAG,CAACP,KAAK,CAAC,0BAA0B,CAAC,CACnCQ,MAAM,CAACC,QAAQ,CAACC,MAAM,EAAE,CAC5B,CACF,CAAC,CAAC,0DACH,kBArBYX,aAAY,kDAqBxB,CAED,GAAMI,YAAW,CAAG,QAAdA,YAAW,CAAIQ,OAAO,CAAK,CAC/B,MAAO,IAAIC,QAAO,CAAC,SAAAC,OAAO,CAAI,CAC5B,GAAMC,OAAM,CAAGC,WAAW,CAAC,UAAM,CAC/BtC,WAAW,CAACkC,OAAO,CAAC,CAACd,IAAI,CAAC,SAAAmB,OAAO,CAAI,CACnC,GAAGA,OAAO,CAAC,CACT,GAAMC,WAAU,CAAGD,OAAO,CAACE,KAAK,CAAC,GAAG,CAAC,CACrCC,aAAa,CAACL,MAAM,CAAC,CACrBD,OAAO,CAACI,UAAU,CAAC,CAAC,CAAC,CAAC,CACxB,CACF,CAAC,CAAC,CACJ,CAAC,CAAE,IAAI,CAAC,CACV,CAAC,CAAC,CACJ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}